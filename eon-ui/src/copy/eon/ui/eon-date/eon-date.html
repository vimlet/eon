<template>

  <!-- Default date input elements -->
  <div class="eon-date-data eon-fg1">
    <label class="eon-date-label"></label>
  </div>

  <div class="eon-date-main eon-bg2 eon-fg1 eon-unselectable">

    <div class="eon-date-subInputs">

      <!-- DATE -->
      <div class="eon-date-subInput" eon-ref="fields.first">
        <input eon-ref="subInputs.first" placeholder="" type="number" autocomplete="off" autocorrect="off"
          autocapitalize="off" spellcheck="false"></input>
      </div>
      <div class="eon-date-separator"></div>
      <div class="eon-date-subInput" eon-ref="fields.second">
        <input eon-ref="subInputs.second" placeholder="" type="number" autocomplete="off" autocorrect="off"
          autocapitalize="off" spellcheck="false"></input>
      </div>
      <div class="eon-date-separator"></div>
      <div class="eon-date-subInput" eon-ref="fields.third">
        <input eon-ref="subInputs.third" placeholder="" type="number" autocomplete="off" autocorrect="off"
          autocapitalize="off" spellcheck="false"></input>
      </div>

      <!-- TIME -->
      <div class="eon-date-subInput" data-field="hours" eon-ref="fields.hours" data-order="3">
        <input eon-ref="subInputs.hours" placeholder="" type="number" autocomplete="off" autocorrect="off"
          autocapitalize="off" spellcheck="false"></input>
      </div>
      <div class="eon-date-timeSeparator">:</div>
      <div class="eon-date-subInput" data-field="minutes" eon-ref="fields.minutes" data-order="4">
        <input eon-ref="subInputs.minutes" placeholder="" type="number" autocomplete="off" autocorrect="off"
          autocapitalize="off" spellcheck="false"></input>
      </div>

    </div>

    <i class="eon-date-button eon-fg2 eon-fg2-hoverable vicon vicon-calendar"></i>

  </div>

  <span class="eon-date-underline"></span>

  <!-- Date calendar elements -->
  <div class="eon-date-calendar eon-unselectable eon-sect1 eon-boxshadow2 eon-fg1">

    <div class="eon-date-header">
      <div class="eon-date-leftNavigation">
        <div class="eon-date-previous eon-unselectable eon-fg1-hoverable">
          <i class="vicon vicon-chevron-left"></i>
        </div>
        <div class="eon-date-next eon-unselectable eon-fg1-hoverable">
          <i class="vicon vicon-chevron-right"></i>
        </div>
      </div>

      <div class="eon-date-daysGridSelectors">
        <div class="eon-date-month eon-fg1-hoverable"></div>
        <div class="eon-date-year eon-fg1-hoverable"></div>
      </div>

      <div class="eon-date-rightNavigation">
        <div class="eon-date-toggle eon-unselectable eon-date-hidden eon-fg1-hoverable" eon-ref="toggle">
          <i class="vicon vicon-clock" eon-ref="toggleIcon"></i>
        </div>
      </div>
    </div>

    <div class="eon-date-body">

      <div class="eon-date-clockView eon-sect1" eon-ref="clockView">
        <div class="eon-date-clock">

          <!-- CLOCK HOURS -->
          <div class="eon-date-hour eon-sect3">
            <div class="eon-date-hoursUp" eon-ref="hoursUp">
              <i class="vicon vicon-chevron-up"></i>
            </div>
            <div class="eon-date-currentHour eon-bg9" eon-ref="currentHours">11</div>
            <div class="eon-date-hoursDown" eon-ref="hoursDown">
              <i class="vicon vicon-chevron-down"></i>
            </div>
          </div>

          <!-- CLOCK MINUTES -->
          <div class="eon-date-minutes eon-sect3">
            <div class="eon-date-minutesUp" eon-ref="minutesUp">
              <i class="vicon vicon-chevron-up"></i>
            </div>
            <div class="eon-date-currentMinutes eon-bg9" eon-ref="currentMinutes">30</div>
            <div class="eon-date-minutesDown" eon-ref="minutesDown">
              <i class="vicon vicon-chevron-down"></i>
            </div>
          </div>

          <!-- CLOCK AM/PM SELECTOR -->
          <div class="eon-date-clockType eon-sect3">
            <div class="eon-date-amButton" eon-ref="amButton">AM</div>
            <div class="eon-date-pmButton" eon-ref="pmButton">PM</div>
          </div>

        </div>
      </div>

    </div>

    <div class="eon-date-footer">

      <div class="eon-date-okButton" eon-ref="okButton">
        OK
      </div>

    </div>

  </div>

  <div class="eon-date-description"></div>

</template>

<script>
  eon.element({

    name: "eon-date",
    style: "eon-date.css",

    themed: true,

    dependencies: [
      "../eon-overlay"
    ],

    privateProperties: {
      /*
      @property (private) {Object} _misc
      @description Object with useful information
      */
      misc: {
        value: {},
        reflect: false
      },
      /*
      @property (private) {object} _refs
      @description Object with references to relevant element nodes
      */
      refs: {
        value: {},
        reflect: false
      },
      /*
      @property (private) {string} _formElement 
      @description Necessary property to be recognized by a form
      */
      formElement: {
        value: "date"
      }
    },

    properties: {
      /*
      @property {String} name
      @description Name to identify the element in a form
      */
      name: {
        value: "",
        reflect: true
      },
      /*
      @property {String} value
      @description Value of the element
      */
      value: {
        value: "",
        reflect: true
      },
      /*
      @property {String} default
      @description Value of the element when the element is reset, if will also be the value of the element if no value is provided
      */
      default: {
        value: "",
        reflect: true
      },
      /*
      @property {Number} fontSize
      @description Basic font size from which we will determine all the sizes
      */
      fontSize: {
        value: 14,
        reflect: true
      },
      /*
      @property {String} type
      @description Determines the type of the date selection (input or calendar)
      */
      type: {
        value: "input",
        reflect: true
      },
      /*
      @property {Boolean} dayPicking
      @description Whether the user will be able to pick a day from the calendar
      */
      dayPicking: {
        value: true,
        reflect: true,
      },
      /*
      @property {Boolean} monthPicking
      @description Whether the user will be able to pick a month from the calendar
      */
      monthPicking: {
        value: true,
        reflect: true,
      },
      /*
      @property {Boolean} yearPicking
      @description Whether the user will be able to pick a year from the calendar
      */
      yearPicking: {
        value: true,
        reflect: true,
      },
      /*
      @property {Boolean} date
      @description Whether the component allows the user to pick the date for the component
      */
      date: {
        value: "true",
        reflect: true,
        reflectDefault: true
      },
      /*
      @property {Boolean} time
      @description Whether the component allows the user to pick the time for the component
      */
      time: {
        value: "false",
        reflect: true,
        reflectDefault: true
      },
      /*
      @property {String} label
      @description Label for the element
      */
      label: {
        value: "",
        reflect: true,
        reflectDefault: true
      },
      /*
      @property {String} locale
      @description Locale to be used in the date
      */
      locale: {
        value: "",
        reflect: true
      },
      /*
      @property {String} mask
      @description Date format of the input
      */
      mask: {
        value: "DDMMYYYY",
        reflect: true
      },
      /*
      @property {String} min
      @description Indicates the inferior limit of the date
      */
      min: {
        value: "",
        reflect: true
      },
      /*
      @property {String} max
      @description Indicates the superior limit of the date
      */
      max: {
        value: "",
        reflect: true
      },
      /*
      @property {String} weekStart
      @description Indicates the first day of the week for the calendar
      */
      weekStart: {
        value: "monday",
        reflect: true
      },
      /*
      @property {String} weekFormat
      @description Indicates the format of the week days header
      */
      weekFormat: {
        value: "short",
        reflect: true
      },
      /*
      @property {String} valueFormat
      @description Indicates the format of the value
      */
      valueFormat: {
        value: "YYYY-MM-DD",
        reflect: true
      },
      /*
      @property {Boolean} toolbar
      @description Indicates whether its in toolbar mode or not
      */
      toolbar: {
        value: false,
        reflect: true
      },
      /*
      @property {Boolean} inline 
      @description Space that occupies the button inside its parent container.
      */
      inline: {
        value: true,
        reflect: true,
        reflectDefault: true
      },
      /*
      @property {Boolean} readonly
      @description Toggles the readonly status of the element
      */
      readonly: {
        value: false,
        reflect: true
      },
      /*
      @property {Boolean} disabled
      @description Toggles the disabled status of the element
      */
      disabled: {
        value: false,
        reflect: true
      },
      /*
      @property {Number} day
      @description Toggles the disabled status of the element
      */
      day: {
        value: "",
        reflect: true
      },
      /*
      @property {Number} month
      @description Toggles the disabled status of the element
      */
      month: {
        value: "",
        reflect: true
      },
      /*
      @property {Number} year
      @description Toggles the disabled status of the element
      */
      year: {
        value: "",
        reflect: true
      },
      /*
      @property {String} labelAnim
      @description Whether the label will have animation or not
      */
      labelAnim: {
        value: true,
        reflect: true
      },
      /*
      @property {String} tooltip
      @description Text to be shown for the element
      */
      tooltip: {
        value: "",
        reflect: true,
        reflectDefault: false
      },
      /*
      @property {Boolean} invalid
      @description Whether the element meets the requirements or not
      */
      invalid: {
        value: false,
        reflect: true,
        reflectDefault: false
      },
      /*
      @property {Number} calendarMaxWidth
      @description Maximum allowed width for the calendar
      */
      calendarMaxWidth: {
        value: 330,
        reflect: true
      }
    },
    privateFunctions: {
      /*
      @function (private) _setup
      @description Here we setup everything we need for the element
      */
      setup: function () {

        var el = this;

        el.locale = (el.locale != undefined && el.locale != "") ? el.locale : navigator.language;

        el._refs.calendar.setAttribute("day-picking", el.dayPicking);
        el._refs.calendar.setAttribute("month-picking", el.monthPicking);
        el._refs.calendar.setAttribute("year-picking", el.yearPicking);

        el._initDefault();

        el._setupMinDate();
        el._setupMaxDate();

        el._setupSeparator();
        el._setupMask();
        el._setupEvents();

        el._setupCalendar();

        el._setupToolbarMode();

        el._initValue();

        el._refresh();

        el._updateLabel();
        el._updateDisabled();
        el._updateReadOnly();

      },
      /*
      @function (private) _setupLabelAnimation
      @description Inits label animation classes and style
      */
      setupLabelAnimation: function () {

        var el = this;

        if (eon.util.isTrue(el.labelAnim)) {

          if (el.value == "" && el.default == "") {
            el._refs.label.classList.add("eon-text-movedLabel");
          }

        }

      },
      /*
      @function (private) _setupType
      @description Creates the structure of the element depending on the type
      */
      setupType: function () {

        var el = this;

        var calendarFragment = document.createDocumentFragment();
        var dataFragment = document.createDocumentFragment();
        var inputFragment = document.createDocumentFragment();

        // Separates the template into 3 different fragments, depending on the type we will re-append 
        // the elements we need
        calendarFragment.appendChild(el.template.querySelector(".eon-date-calendar"));
        dataFragment.appendChild(el.template.querySelector(".eon-date-data"));
        inputFragment.appendChild(el.template);

        if (el.type == "calendar") {

          el.template.appendChild(dataFragment);
          el.template.appendChild(calendarFragment);

          eon.addResizeListener(el._refs.calendar, "calendar", function () {
            el._handleAutoHeight();
            el._handleFonts();
          });

        } else {

          el.template.appendChild(dataFragment);
          el.template.appendChild(inputFragment);

          el._refs.overlay.appendChild(calendarFragment);

        }

      },
      /*
      @function (private) _setupCalendar
      @description Prepares the calendar and its grids/events
      */
      setupCalendar: function () {

        var el = this;

        el._setupWeekDays();
        el._setupYearsGrid();
        el._setupMonthsGrid();
        el._setupDaysGrid();

        el._handleAutoHeight();
        el._handleFonts();

        // Events

        el._refs.calendarButton.addEventListener('click', function (e) {
          if (!eon.util.isTrue(el.readonly) && !eon.util.isTrue(el.disabled)) {
            el._expand();
          }
        }, false);

        el._refs.previous.addEventListener(el._misc.downTrigger, function (e) {
          e.stopPropagation();
          e.preventDefault();
          el._goToPrevious(this);
        });

        el._refs.next.addEventListener(el._misc.downTrigger, function (e) {
          e.stopPropagation();
          e.preventDefault();
          el._goToNext(this);
        });

        el._refs.toggle.addEventListener(el._misc.downTrigger, function (e) {

          e.stopPropagation();
          e.preventDefault();

          if (el._misc.currentView == el._refs.clockView) {
            el._showDaysGrid();
          } else {
            el._showClockView();
          }

        });

        el._refs.calendar.querySelector(".eon-date-header .eon-date-month").addEventListener(el._misc.downTrigger, function (e) {
          if (eon.util.isTrue(el.monthPicking)) {
            e.stopPropagation();
            e.preventDefault();
            el._showMonthsGrid();
          }
        });

        el._refs.calendar.querySelector(".eon-date-header .eon-date-year").addEventListener(el._misc.downTrigger, function (e) {
          if (eon.util.isTrue(el.yearPicking)) {
            e.stopPropagation();
            e.preventDefault();
            el._showYearsGrid();
          }
        });

        eon.registerPathListener(el._refs.calendar, "calendar");

      },
      /*
      @function (private) _setupOverlay
      @description Sets up basic properties for the data object
      */
      setupOverlay: function () {

        var el = this;

        el._refs.overlay = el.generateOverlayNode();
        el._refs.overlay.classList.add("eon-date-overlay", "eon-bg1-modal");

        // Prevents scrolling on mobile devices
        el._refs.overlay.addEventListener("wheel", function (e) {
          if (!el._refs.calendar.isOnPath) {
            e.preventDefault();
            e.stopPropagation();
          }
        }, { passive: false });

        // Overlay blur
        el._refs.overlay.addEventListener("click", function (e) {
          if (el._misc.modal.active && !el._refs.calendar.isOnPath) {
            e.preventDefault();
            e.stopPropagation();
            el._shrink();
          }
        });

        // If the user scrolls the window scrollbar we hide the calendar
        window.addEventListener("scroll", function (e) {
          if (el._misc.modal.active) {
            el._shrink();
          }
        });

      },
      /*
      @function (private) _setupMisc
      @description Sets up basic properties for the misc object
      */
      setupMisc: function () {

        var el = this;

        el._misc.current = {};
        el._misc.mask = {};
        el._misc.min = {};
        el._misc.min.active = false;
        el._misc.max = {};
        el._misc.max.active = false;
        el._misc.modal = {};

        el._misc.clock = {};

        el._misc.weekDays = {};
        el._misc.current = {};
        el._misc.selected = {};
        el._misc.selector = {};
        el._misc.selector.range = {};

        el._misc.descriptionText = "";

        el._misc.downTrigger = "click";
        el._misc.heightRatio = 0.703703;

      },
      /*
      @function (private) _setupRefs
      @description Creates some fast access elements so that theres no need for calling the QuerySelector all the time.
      */
      setupRefs: function () {

        var el = this;

        // Input related references
        el._refs.subInputsWrapper = el.template.querySelector(".eon-date-subInputs");

        el._refs.underline = el.template.querySelector(".eon-date-underline");

        el._refs.data = el.template.querySelector(".eon-date-data");
        el._refs.main = el.template.querySelector(".eon-date-main");
        el._refs.label = el.template.querySelector(".eon-date-label");

        el._refs.calendarButton = el.template.querySelector(".eon-date-button");

        // Calendar related references
        el._refs.calendar = el.template.querySelector(".eon-date-calendar");

        el._refs.selectorsContainer = el._refs.calendar.querySelector(".eon-date-daysGridSelectors");
        el._refs.monthSelector = el._refs.calendar.querySelector(".eon-date-header .eon-date-month");
        el._refs.yearSelector = el._refs.calendar.querySelector(".eon-date-header .eon-date-year");

        el._refs.header = el._refs.calendar.querySelector(".eon-date-header");
        el._refs.body = el._refs.calendar.querySelector(".eon-date-body");

        el._refs.description = el.template.querySelector(".eon-date-description");

        el._refs.previous = el._refs.calendar.querySelector(".eon-date-previous");
        el._refs.next = el._refs.calendar.querySelector(".eon-date-next");

      },
      /*
      @function (private) {String} _setupDescription
      @description Creates the touch blur
      */
      setupDescription: function () {

        var el = this;

        if (el.tooltip != "") {
          el.updateDescription(el.tooltip);
        }

      },
      /*
      @function (private) _setupMask
      @description Sets up the mask and the sub inputs to be used for the user input
      */
      setupMask: function () {

        var el = this;

        el._misc.mask.order = [];

        var dayFormat = el.mask.match(/[d|D]{1,2}/)[0];
        var monthFormat = el.mask.match(/[M]{1,4}/)[0];
        var yearFormat = el.mask.match(/[y|Y]{2,4}/)[0];
        var hoursFormat = "hh";
        var minutesFormat = "mm";

        el._misc.mask["day"] = {};
        el._misc.mask["month"] = {};
        el._misc.mask["year"] = {};
        el._misc.mask["hours"] = {};
        el._misc.mask["minutes"] = {};

        // Saving corresponding mask for day, month and year
        if (dayFormat && monthFormat && yearFormat) {

          var yearOrder = el.mask.indexOf(yearFormat);

          el._misc.mask.day.format = dayFormat;
          el._misc.mask.month.format = monthFormat;
          el._misc.mask.year.format = yearFormat;

          if (el.mask.indexOf(dayFormat) < el.mask.indexOf(monthFormat)) {

            el._misc.mask.order[0] = "day";
            el._misc.mask.order[1] = "month";

          } else {

            el._misc.mask.order[0] = "month";
            el._misc.mask.order[1] = "day";
          }

          if (el.mask.indexOf(yearFormat) < el.mask.indexOf(dayFormat)) {
            el._misc.mask.order.splice(0, 0, "year");
          } else if (el.mask.indexOf(yearFormat) < el.mask.indexOf(monthFormat)) {
            el._misc.mask.order.splice(1, 0, "year");
          } else {
            el._misc.mask.order[2] = "year";
          }

          el.mask = el._misc.mask[el._misc.mask.order[0]].format + el._misc.mask[el._misc.mask.order[1]].format + el._misc.mask[el._misc.mask.order[2]].format;

          el._refs.subInputs.first.placeholder = el._misc.mask[el._misc.mask.order[0]].format;
          el._refs.subInputs.second.placeholder = el._misc.mask[el._misc.mask.order[1]].format;
          el._refs.subInputs.third.placeholder = el._misc.mask[el._misc.mask.order[2]].format;

        } else {

          el._misc.mask.order = ["day", "month", "year"];

          el._misc.mask.day.format = "DD";
          el._misc.mask.month.format = "MM";
          el._misc.mask.year.format = "YYYY";

          el.mask = "DDMMYYYY";

          el._refs.subInputs.first.placeholder = "DD";
          el._refs.subInputs.second.placeholder = "MM";
          el._refs.subInputs.third.placeholder = "YYYY";
        }

        // Saving masks for hours and minutes
        el._misc.mask.hours.format = hoursFormat;
        el._misc.mask.minutes.format = minutesFormat;

        // Setting hours and minutes placeholders
        el._refs.subInputs.hours.placeholder = hoursFormat;
        el._refs.subInputs.minutes.placeholder = minutesFormat;

        var firstSection = el._misc.mask[el._misc.mask.order[0]];
        var secondSection = el._misc.mask[el._misc.mask.order[1]];
        var thirdSection = el._misc.mask[el._misc.mask.order[2]];

        firstSection.start = 0;
        firstSection.end = el._misc.mask[el._misc.mask.order[0]].format.length;

        secondSection.start = firstSection.end + el._misc.separator.length;
        secondSection.end = secondSection.start + el._misc.mask[el._misc.mask.order[1]].format.length;

        thirdSection.start = secondSection.end + el._misc.separator.length;
        thirdSection.end = thirdSection.start + el._misc.mask[el._misc.mask.order[2]].format.length;

        el._refs.fields.first.dataset.field = el._misc.mask.order[0];
        el._refs.fields.first.dataset.order = "0";

        el._refs.fields.second.dataset.field = el._misc.mask.order[1];
        el._refs.fields.second.dataset.order = "1";

        el._refs.fields.third.dataset.field = el._misc.mask.order[2];
        el._refs.fields.third.dataset.order = "2";

        var separators = el.querySelectorAll(".eon-date-subInputs .eon-date-separator");

        for (var i = 0; i < separators.length; i++) {
          separators[i].innerHTML = el._misc.separator;
        }

      },
      /*
      @function (private) _setupEvents
      @description Creates the events for the sub inputs
      */
      setupEvents: function () {

        var el = this;

        el._setupFocusEvents();
        el._setupBlurEvents();
        el._setupOnKeyDownEvents();
        el._setupOnKeyUpEvents();
        el._setupPasteEvents();

      },
      /*
      @function (private) _setupFocusEvents
      @description Creates the focus events for the sub inputs
      */
      setupFocusEvents: function () {

        var el = this;
        el._labelNode = el.querySelector(".eon-date-label");

        el._refs.subInputs.first.addEventListener("focus", function (e) {
          if (!eon.util.isTrue(el.readonly) && !eon.util.isTrue(el.disabled)) {
            el._handleFocus(this);
            el._assignFocusStyle();
          }
        }, true);

        el._refs.subInputs.second.addEventListener("focus", function (e) {
          if (!eon.util.isTrue(el.readonly) && !eon.util.isTrue(el.disabled)) {
            el._handleFocus(el._refs.subInputs.second);
            el._assignFocusStyle();
          }
        }, true);

        el._refs.subInputs.third.addEventListener("focus", function (e) {
          if (!eon.util.isTrue(el.readonly) && !eon.util.isTrue(el.disabled)) {
            el._handleFocus(el._refs.subInputs.third);
            el._assignFocusStyle();
          }
        }, true);

        el._refs.subInputs.hours.addEventListener("focus", function (e) {
          if (!eon.util.isTrue(el.readonly) && !eon.util.isTrue(el.disabled)) {
            el._handleFocus(el._refs.subInputs.hours);
            el._assignFocusStyle();
          }
        }, true);

        el._refs.subInputs.minutes.addEventListener("focus", function (e) {
          if (!eon.util.isTrue(el.readonly) && !eon.util.isTrue(el.disabled)) {
            el._handleFocus(el._refs.subInputs.minutes);
            el._assignFocusStyle();
          }
        }, true);

      },
      /*
      @function (private) _setupBlurEvents
      @description Sets up the blur events for the sub inputs
      */
      setupBlurEvents: function () {

        var el = this;

        el._refs.subInputs.first.addEventListener("blur", function () {
          if ((el._refs.fields.first.dataset.field == "day" || el._refs.fields.first.dataset.field == "month") && el._refs.subInputs.first.value.length == 1 && el._refs.subInputs.first.value.length < el._misc.mask[el._misc.mask.order[0]].format.length) {
            el._refs.subInputs.first.value = "0" + el._refs.subInputs.first.value;
          }
          el._revertFocusStyle();
        }, true);

        el._refs.subInputs.second.addEventListener("blur", function () {
          if ((el._refs.fields.second.dataset.field == "day" || el._refs.fields.second.dataset.field == "month") && el._refs.subInputs.second.value.length == 1 && el._refs.subInputs.second.value.length < el._misc.mask[el._misc.mask.order[1]].format.length) {
            el._refs.subInputs.second.value = "0" + el._refs.subInputs.second.value;
          }
          el._revertFocusStyle();
        }, true);

        el._refs.subInputs.third.addEventListener("blur", function () {
          if ((el._refs.fields.third.dataset.field == "day" || el._refs.fields.third.dataset.field == "month") && el._refs.subInputs.third.value.length == 1 && el._refs.subInputs.third.value.length < el._misc.mask[el._misc.mask.order[2]].format.length) {
            el._refs.subInputs.third.value = "0" + el._refs.subInputs.third.value;
          }
          el._revertFocusStyle();
        }, true);

        el._refs.subInputs.hours.addEventListener("blur", function () {
          if (el._refs.subInputs.hours.value.length == 1 && el._refs.subInputs.hours.value.length < 2) {
            el._refs.subInputs.hours.value = "0" + el._refs.subInputs.hours.value;
          }
          el._revertFocusStyle();
        }, true);

        el._refs.subInputs.minutes.addEventListener("blur", function () {
          if (el._refs.subInputs.minutes.value.length == 1 && el._refs.subInputs.minutes.value.length < 2) {
            el._refs.subInputs.minutes.value = "0" + el._refs.subInputs.minutes.value;
          }
          el._revertFocusStyle();
        }, true);

      },
      /*
      @function (private) _setupOnKeyDownEvents
      @description Sets up the keydown events for the sub inputs
      */
      setupOnKeyDownEvents: function () {

        var el = this;

        el._refs.subInputs.first.addEventListener("keydown", function (e) {
          el._handleKeyDown(el._refs.subInputs.first, e);
        }, true);

        el._refs.subInputs.second.addEventListener("keydown", function (e) {
          el._handleKeyDown(el._refs.subInputs.second, e);
        }, true);

        el._refs.subInputs.third.addEventListener("keydown", function (e) {
          el._handleKeyDown(el._refs.subInputs.third, e);
        }, true);

        el._refs.subInputs.hours.addEventListener("keydown", function (e) {
          el._handleKeyDown(el._refs.subInputs.hours, e);
        }, true);

        el._refs.subInputs.minutes.addEventListener("keydown", function (e) {
          el._handleKeyDown(el._refs.subInputs.minutes, e);
        }, true);

      },
      /*
      @function (private) _setupOnKeyUpEvents
      @description Sets up the keyup events for the sub inputs
      */
      setupOnKeyUpEvents: function () {

        var el = this;

        el._refs.subInputs.first.addEventListener("keyup", function (e) {
          el._handleKeyUp(el._refs.subInputs.first, e);
        }, true);

        el._refs.subInputs.second.addEventListener("keyup", function (e) {
          el._handleKeyUp(el._refs.subInputs.second, e);
        }, true);

        el._refs.subInputs.third.addEventListener("keyup", function (e) {
          el._handleKeyUp(el._refs.subInputs.third, e);
        }, true);

        el._refs.subInputs.hours.addEventListener("keyup", function (e) {
          el._handleKeyUp(el._refs.subInputs.hours, e);
        }, true);

        el._refs.subInputs.minutes.addEventListener("keyup", function (e) {
          el._handleKeyUp(el._refs.subInputs.minutes, e);
        }, true);

      },
      /*
      @function (private) _setupPasteEvents
      @description Sets up the events for the sub inputs to prevent paste
      */
      setupPasteEvents: function () {

        var el = this;

        el._refs.subInputs.first.addEventListener("paste", function (e) {
          e.preventDefault;
          return false;
        }, true);

        el._refs.subInputs.second.addEventListener("paste", function (e) {
          e.preventDefault;
          return false;
        }, true);

        el._refs.subInputs.third.addEventListener("paste", function (e) {
          e.preventDefault;
          return false;
        }, true);

      },
      /*
      @function (private) _setupMinDate
      @description Sets up the inferior limit of the date
      */
      setupMinDate: function () {

        var el = this;

        if (el.min != "") {

          var minDate = el.min.split[" "][1] ? el.min.split[" "][0] : el.min;
          var minTime = el.min.split[" "][1] ? el.min.split[" "][1] : null;

          if (minDate.indexOf("/") > -1) {
            var splitMinDate = minDate.split("/");
            el._misc.min.day = parseInt(splitMinDate[0]);
            el._misc.min.month = parseInt(splitMinDate[1]) - 1;
            el._misc.min.year = parseInt(splitMinDate[2]);
          }

          if (minTime && minTime.indexOf(":")) {
            var splitMinTime = minDate.split("/");
            el._misc.min.hours = parseInt(splitMinTime[0]);
            el._misc.min.minutes = parseInt(splitMinTime[1]);
          }

          el._misc.min.active = true;

        }

      },
      /*
      @function (private) _setupMaxDate
      @description Sets up the superior limit of the date
      */
      setupMaxDate: function () {

        var el = this;

        if (el.max != "") {

          var maxDate = el.max.split[" "][1] ? el.max.split[" "][0] : el.max;
          var maxTime = el.max.split[" "][1] ? el.max.split[" "][1] : null;

          if (maxDate.indexOf("/") > -1) {
            var splitMaxDate = maxDate.split("/");
            el._misc.max.day = parseInt(splitMaxDate[0]);
            el._misc.max.month = parseInt(splitMaxDate[1]) - 1;
            el._misc.max.year = parseInt(splitMaxDate[2]);
          }

          if (maxTime && maxTime.indexOf(":")) {
            var splitMaxTime = maxTime.split("/");
            el._misc.max.hours = parseInt(splitMaxTime[0]);
            el._misc.max.minutes = parseInt(splitMaxTime[1]);
          }

          el._misc.max.active = true;

        }

      },
      /*
      @function (private) {String} _setupSeparator
      @description Takes the value format and saves its separator
      */
      setupSeparator: function () {
        var el = this;
        el._misc.separator = eon.time.getFormatSeparator(el.valueFormat);
      },
      /*
      @function (private) _setupToolbarMode
      @description Adds whats needed to overwrite the default style
      */
      setupToolbarMode: function () {
        var el = this;
        el._refs.main.classList.add("toolbar");
      },
      /*
      @function (private) _addFocusStyle
      @description When focused, it adds the corresponding style
      */
      addFocusStyle: function () {

        var el = this;

        if (eon.util.isTrue(el.toolbar)) {
          el._refs.main.classList.add("toolbar");
        }

      },
      /*
      @function (private) _setupWeekDays
      @description Sets up the weekdays, including its locale, format and weekDayStart
      */
      setupWeekDays: function () {

        var el = this;

        function reorderWeekDays(array, oldIndex, newIndex) {
          while (oldIndex < 0) {
            oldIndex += array.length;
          }
          while (newIndex < 0) {
            newIndex += array.length;
          }
          if (newIndex >= array.length) {
            var k = newIndex - array.length;
            while ((k--) + 1) {
              array.push(undefined);
            }
          }
          array.splice(newIndex, 0, array.splice(oldIndex, 1)[0]);
          return array;
        }

        el._misc.weekDays.display = eon.time.getWeekDays(el.locale, el.weekFormat);
        el._misc.weekDays.keys = eon.time.getWeekDays("en", "long");

        if (el._misc.weekDays.keys[0].toLowerCase() != el.weekStart.toLowerCase()) {

          for (var i = 0; i < el._misc.weekDays.keys.length; i++) {

            el._misc.weekDays.display = reorderWeekDays(el._misc.weekDays.display, 6, 0);
            el._misc.weekDays.keys = reorderWeekDays(el._misc.weekDays.keys, 6, 0);

            if (el._misc.weekDays.keys[0].toLowerCase() == el.weekStart.toLowerCase()) {
              break;
            }
          }
        }
      },
      /*
      @function (private) _setupDaysGrid
      @description Sets up the days Grid
      */
      setupDaysGrid: function () {

        var el = this;

        if (el.type.toLowerCase() != "calendar" || el.type.toLowerCase() == "calendar" && eon.util.isTrue(el.dayPicking)) {

          var week;
          var day;

          var daysGridContainer = document.createElement("div");
          var weekDaysContainer = document.createElement("div");
          var daysGrid = document.createElement("div");

          var weeksFragment = document.createDocumentFragment();

          daysGridContainer.style.zIndex = -1;

          daysGridContainer.classList.add("eon-date-daysGrid");
          weekDaysContainer.classList.add("eon-date-weekDays");
          daysGrid.classList.add("eon-date-grid");

          daysGridContainer.appendChild(weekDaysContainer);
          daysGridContainer.appendChild(daysGrid);
          el._refs.calendar.querySelector(".eon-date-body").appendChild(daysGridContainer);

          el._refs.daysGrid = daysGridContainer;

          el._createWeekDaysHeaders();

          for (var i = 1; i <= 6; i++) {

            week = document.createElement("div");
            week.classList.add("eon-date-week");

            for (var j = 1; j <= 7; j++) {

              day = document.createElement("div");
              day.classList.add("eon-date-day", "eon-bg2-hoverable", "eon-fg1-hoverable");
              day.addEventListener(el._misc.downTrigger, function (e) {
                e.preventDefault();
                e.stopPropagation();
                el._selectDay(this);
              });

              week.appendChild(day);
            }
            weeksFragment.appendChild(week);
          }
          daysGrid.appendChild(weeksFragment);

        }

      },
      /*
      @function (private) _setupMonthsGrid
      @description Sets up the months Grid
      */
      setupMonthsGrid: function () {

        var el = this;

        if (el.type.toLowerCase() != "calendar" || el.type.toLowerCase() == "calendar" && eon.util.isTrue(el.monthPicking)) {

          var row;
          var month;

          var monthsGrid = document.createElement("div");
          var rowsFragment = document.createDocumentFragment();

          var months = eon.time.getMonthNames(el.locale, "short");

          monthsGrid.classList.add("eon-date-monthsGrid", "eon-sect1");
          el._refs.calendar.querySelector(".eon-date-body").appendChild(monthsGrid);

          el._refs.monthsGrid = monthsGrid;

          row = document.createElement("div");
          row.classList.add("eon-date-row");

          for (var i = 0; i < months.length; i++) {

            month = document.createElement("div");
            month.classList.add("eon-date-month", "eon-bg2-hoverable", "eon-fg1-hoverable");
            month.innerHTML = months[i];
            month.dataset.index = i;

            month.addEventListener(el._misc.downTrigger, function (e) {
              e.preventDefault();
              e.stopPropagation();
              el._selectMonth(this);
            });

            row.appendChild(month);

            if (row.childNodes.length == 4) {
              rowsFragment.appendChild(row);
              row = document.createElement("div");
              row.classList.add("eon-date-row");
            }
          }

          monthsGrid.appendChild(rowsFragment);

        }

      },
      /*
      @function (private) _setupYearsGrid
      @description Sets up the years Grid
      */
      setupYearsGrid: function () {

        var el = this;

        if (el.type.toLowerCase() != "calendar" || el.type.toLowerCase() == "calendar" && eon.util.isTrue(el.yearPicking)) {

          var row;
          var year;

          var yearsGrid = document.createElement("div");
          var rowsFragment = document.createDocumentFragment();

          var currentYear = new Date();
          var years = [];

          currentYear = currentYear.getFullYear();

          for (var i = currentYear - 6; i < currentYear + 6; i++) {
            years.push(i);
          }

          yearsGrid.classList.add("eon-date-yearsGrid", "eon-sect1");
          el._refs.calendar.querySelector(".eon-date-body").appendChild(yearsGrid);

          el._refs.yearsGrid = yearsGrid;

          row = document.createElement("div");
          row.classList.add("eon-date-row");

          for (var i = 0; i < years.length; i++) {

            year = document.createElement("div");
            year.classList.add("eon-date-year", "eon-bg2-hoverable", "eon-fg1-hoverable");

            year.addEventListener(el._misc.downTrigger, function (e) {
              e.preventDefault();
              e.stopPropagation();
              el._selectYear(this);
            });

            row.appendChild(year);

            if (row.childNodes.length == 4) {
              rowsFragment.appendChild(row);
              row = document.createElement("div");
              row.classList.add("eon-date-row");
            }
          }

          yearsGrid.appendChild(rowsFragment);

        }

      },
      setupClock: function () {
        var el = this;

        if (!eon.util.isTrue(el.time)) {

          el._refs.toggle.style.display = "none";

        } else {

          el._refs.hoursUp.addEventListener("click", function () {
            if (el._misc.clock.currentAMHours < 12) {

              el._misc.clock.currentAMHours++;
              el._misc.clock.currentPMHours = el._misc.clock.isPM ? el._getPMHours(el._misc.clock.currentAMHours) : el._misc.clock.currentAMHours;
              el._refs.currentHours.innerHTML = ("0" + el._misc.clock.currentAMHours).slice(-2);

              if (el.type == "calendar") {
                el._updateWithCurrentValues();
              }

            }
          });

          el._refs.hoursDown.addEventListener("click", function () {
            if (el._misc.clock.currentAMHours > 1) {

              el._misc.clock.currentAMHours--;
              el._misc.clock.currentPMHours = el._misc.clock.isPM ? el._getPMHours(el._misc.clock.currentAMHours) : el._misc.clock.currentAMHours;
              el._refs.currentHours.innerHTML = ("0" + el._misc.clock.currentAMHours).slice(-2);

              if (el.type == "calendar") {
                el._updateWithCurrentValues();
              }

            }
          });

          el._refs.minutesUp.addEventListener("click", function () {
            if (el._misc.clock.currentMinutes < 60) {

              el._misc.clock.currentMinutes++;
              el._refs.currentMinutes.innerHTML = ("0" + el._misc.clock.currentMinutes).slice(-2);

              if (el.type == "calendar") {
                el._updateWithCurrentValues();
              }

            }
          });

          el._refs.minutesDown.addEventListener("click", function () {
            if (el._misc.clock.currentMinutes > 0) {

              el._misc.clock.currentMinutes--;
              el._refs.currentMinutes.innerHTML = ("0" + el._misc.clock.currentMinutes).slice(-2);

              if (el.type == "calendar") {
                el._updateWithCurrentValues();
              }

            }
          });

          el._refs.amButton.addEventListener("click", function () {

            el._misc.clock.isPM = false;
            el._misc.clock.currentPMHours = el._misc.clock.currentAMHours;

            el._refs.amButton.classList.add("eon-bg2-active");
            el._refs.pmButton.classList.remove("eon-bg2-active");

            if (el.type == "calendar") {
              el._updateWithCurrentValues();
            }

          });

          el._refs.pmButton.addEventListener("click", function () {

            el._misc.clock.isPM = true;
            el._misc.clock.currentPMHours = el._getPMHours(el._misc.clock.currentAMHours);

            el._refs.amButton.classList.remove("eon-bg2-active");
            el._refs.pmButton.classList.add("eon-bg2-active");

            if (el.type == "calendar") {
              el._updateWithCurrentValues();
            }

          });

          if (!eon.util.isTrue(el.date)) {
            el._refs.calendarButton.classList.remove("vicon-calendar");
            el._refs.calendarButton.classList.add("vicon-clock");
          }

        }

      },
      setCurrentTime: function () {
        var now = new Date();
        this._setTime(now.getHours(), now.getMinutes());
      },
      setTime: function (hours, minutes) {
        var el = this;

        el._misc.clock = el._misc.clock || {};

        el._misc.clock.isPM = false;
        el._misc.clock.currentPMHours = parseInt(hours);
        el._misc.clock.currentMinutes = parseInt(minutes);

        el._misc.clock.isPM = el._misc.clock.currentPMHours > 12 ? true : false;
        el._misc.clock.currentPMHours = el._misc.clock.isPM ? el._misc.clock.currentAMHours + 12 : el._misc.clock.currentPMHours;
        el._misc.clock.currentAMHours = el._misc.clock.isPM ? el._misc.clock.currentPMHours - 12 : el._misc.clock.currentPMHours;

        el._refs.currentHours.innerHTML = ("0" + el._misc.clock.currentAMHours).slice(-2);
        el._refs.currentMinutes.innerHTML = ("0" + el._misc.clock.currentMinutes).slice(-2);

        el._refs.subInputs.hours.value = ("0" + el._misc.clock.currentPMHours).slice(-2);
        el._refs.subInputs.minutes.value = ("0" + el._misc.clock.currentMinutes).slice(-2);

        if (el._misc.clock.isPM) {
          el._refs.amButton.classList.remove("eon-bg2-active");
          el._refs.pmButton.classList.add("eon-bg2-active");
        } else {
          el._refs.amButton.classList.add("eon-bg2-active");
          el._refs.pmButton.classList.remove("eon-bg2-active");
        }

      },
      /*
      @function (private) _assignFocusStyle
      @description When focused, it adds the corresponding style
      */
      assignFocusStyle: function () {

        var el = this;

        el._refs.underline.classList.add("animate");
        el.classList.add("eon-date-focus");
        el._labelNode.classList.add("eon-fg1");

        el._animateLabel();

      },
      /*
      @function (private) _revertFocusStyle
      @description On blur, removes the corresponding style
      */
      revertFocusStyle: function () {

        var el = this;

        el._refs.underline.classList.remove("animate");
        el.classList.remove("eon-date-focus");
        el._labelNode.classList.remove("eon-fg1");

        el._animateLabel();

      },
      /*
      @function (private) _animateLabel
      @description Depending on the focus state animates the label or not
      */
      animateLabel: function () {

        var el = this;

        if (eon.util.isTrue(el.labelAnim)) {

          if (el.classList.contains("eon-date-focus") || el.value != "") {
            el._refs.label.classList.remove("eon-date-movedLabel");
          } else {
            el._refs.label.classList.add("eon-date-movedLabel");
          }

        }

      },
      /*
      @function (private) _assignCalendarStyle
      @description Assigns the calendar's width and position relative to the date
      */
      assignCalendarStyle: function () {

        var el = this;

        if (window.innerWidth <= eon.tabletWidth) {

          if (!el._refs.overlay.classList.contains("eon-date-device")) {

            el._refs.calendar.style.top = "auto";
            el._refs.calendar.style.left = "auto";

            el._refs.overlay.classList.add("eon-date-device");
            el._refs.overlay.classList.add("eon-bg1-modal");

          }

        } else {

          var width = (parseInt(el._refs.main.offsetWidth) * 1.5);
          var height;

          width = width > el.calendarMaxWidth ? el.calendarMaxWidth : width;
          height = width * el._misc.heightRatio;

          el._refs.overlay.classList.remove("eon-date-device");
          el._refs.overlay.classList.remove("eon-bg1-modal");

          // el._refs.calendar.style.top = el._refs.main.getBoundingClientRect().top + 1 + el._refs.main.offsetHeight + "px";
          el._refs.calendar.style.top = el._refs.main.getBoundingClientRect().top + el._refs.main.offsetHeight / 2 - height / 2 + "px";
          // el._refs.calendar.style.left = el._refs.main.getBoundingClientRect().left + "px";
          el._refs.calendar.style.left = el._refs.main.getBoundingClientRect().left + el._refs.main.offsetWidth / 2 - width / 2 + "px";
          // el._refs.calendar.style.width = el._refs.main.offsetWidth + "px";
          // el._refs.calendar.style.height = "auto";
          el._refs.calendar.style.width = width + "px";
          el._refs.body.style.height = height + "px";

        }

      },
      /*
      @function (private) _expand
      @description Shows the calendar
      */
      expand: function () {

        var el = this;

        el._assignCalendarStyle();
        el._assignFocusStyle();

        el._refresh();

        document.body.appendChild(el._refs.overlay);

        el._handleAutoHeight();
        el._handleFonts();

        el._misc.modal.active = true;

        el._animateExpand();

      },
      /*
      @function (private) _animateExpand
      @description Expands the items dropdown with transition
      */
      animateExpand: function () {

        var el = this;

        setTimeout(function () {
          el._refs.overlay.removeEventListener("transitionend", el._misc.calendarShrinkFn);
          el._refs.overlay.classList.add("eon-date-opaque");
        }, 0);

      },
      /*
      @function (private) _shrink
      @description Hides the calendar
      */
      shrink: function () {

        var el = this;

        el._misc.calendarShrinkFn = el._misc.calendarShrinkFn || function () {

          el._revertFocusStyle();

          if (el._refs.overlay.parentNode) {
            el._refs.overlay.parentNode.removeChild(el._refs.overlay);
          }

        };

        el._misc.modal.active = false;

        el._animateShrink();

      },
      /*
      @function (private) _animateShrink
      @description Expands the items dropdown with transitions
      */
      animateShrink: function () {

        var el = this;

        el._refs.overlay.addEventListener("transitionend", el._misc.calendarShrinkFn);
        el._refs.overlay.classList.remove("eon-date-opaque");

      },
      /*
      @function (private) _validate
      @description Validates if what the user typed is a valid date
      */
      validate: function () {

        var el = this;

        var inputs = el.querySelectorAll(".eon-date-subInputs .eon-date-subInput input");

        var day = inputs[el._misc.mask.order.indexOf("day")].value;
        var month = inputs[el._misc.mask.order.indexOf("month")].value;
        var year = inputs[el._misc.mask.order.indexOf("year")].value;

        var validDate = false;
        var date;

        var obj = {

          day: day,
          month: month,
          year: year

        }

        //If all the three fields have text typed in and their content is valid we set the boolean to true
        if (year != "") {
          if (month != "" && parseInt(month) > 0 && parseInt(month) <= 12) {
            if (day != "" && day > 0 && day <= eon.time.getDaysInMonth(year, parseInt(month) - 1)) {
              validDate = true;
            }
          }
        }

        //If its valid we remove the error classes, and update everything according to the new date
        if (validDate) {

          el.invalid = false;

          el._misc.current.day = parseInt(day);
          el._misc.current.month = parseInt(month) - 1;
          el._misc.current.year = parseInt(year);

          el._misc.preventUpdate = true;

          el.value = eon.time.generateOutput(obj, el.valueFormat);
          el._refresh();


        } else {

          el.invalid = true;

          el._misc.preventUpdate = true;
          el.value = "";

        }

      },
      /*
      @function (private) _initDefault
      @description If a value has been provided by the user we set it for our element
      */
      initDefault: function () {
        this.value = this.default != "" && this.value == "" ? this.default : this.value;
      },
      /*
      @function (private) _initValue
      @description If a value has been provided by the user we set it for our element
      */
      initValue: function () {

        var el = this;
        var dateObj = el.value == "" ? eon.time.getDateValueObjectFromDate(new Date(), el.time) : eon.time.getDateValueObjectFromString(el.value, el.valueFormat, el.time);

        if (el._exceedsMinDate(dateObj)) {

          dateObj.minutes = el._misc.min.minutes;
          dateObj.hours = el._misc.min.hour;
          dateObj.day = el._misc.min.day;
          dateObj.month = el._misc.min.month + 1;
          dateObj.year = el._misc.min.year;

        } else if (el._exceedsMaxDate(dateObj)) {

          dateObj.minutes = el._misc.max.minutes;
          dateObj.hours = el._misc.max.hour;
          dateObj.day = el._misc.max.day;
          dateObj.month = el._misc.max.month + 1;
          dateObj.year = el._misc.max.year;

        }

        dateObj = el._formatObj(dateObj);
        
        el.value = eon.time.generateOutput(dateObj, el.valueFormat);
        
        el._refresh();
        el._updateValue();

      },
      /*
      @function (private) {String} _format
      @description We replace the format with the given data, in case the field's length is lower than its format then we add 0 as needed
      @param {String} text
      @param {String} format
      */
      format: function (text, format) {

        var el = this;

        text = text ? text + "" : "";
        
        if (format) {

          if (text.length > 0 && text.length < format.length) {
            for (var i = 0; i < (format.length - text.length); i++) {
              text = "0" + text;
            }
          }

        }

        return text;

      },
      /*
      @function (private) {Boolean} _isMinMonth
      @description Returns true if the month is equal/lower than the min month
      @param {Number} year
      @param {Number} month
      */
      isMinMonth: function (year, month) {
        return (year == this._misc.min.year && month <= this._misc.min.month || year < this._misc.min.year);
      },
      /*
      @function (private) {Boolean} _isMaxMonth
      @description Returns true if the month is equal/higher than the max month
      @param {Number} year
      @param {Number} month
      */
      isMaxMonth: function (year, month) {
        return (year == this._misc.max.year && month >= this._misc.max.month || year > this._misc.max.year);
      },
      /*
      @function (private) _handleFocus
      @description Moves the cursor to the right when a sub input is being focused
      @param {Object} subInput
      */
      handleFocus: function (subInput) {
        if (subInput.firstChild) {
          var range = document.createRange();
          var sel = window.getSelection();

          range.selectNodeContents(subInput);

          sel.removeAllRanges();
          sel.addRange(range);

        }
      },
      /*
      @function (private) {Number}  _getCaretPosition
      @description function_description
      @param {Object} editableDiv
      */
      getCaretPosition: function (editableDiv) {
        var caretPos = 0,
          sel, range;
        if (window.getSelection) {
          sel = window.getSelection();
          if (sel.rangeCount) {
            range = sel.getRangeAt(0);
            if (range.commonAncestorContainer.parentNode == editableDiv) {
              caretPos = range.endOffset;
            }
          }
        } else if (document.selection && document.selection.createRange) {
          range = document.selection.createRange();
          if (range.parentElement() == editableDiv) {
            var tempEl = document.createElement("span");
            editableDiv.insertBefore(tempEl, editableDiv.firstChild);
            var tempRange = range.duplicate();
            tempRange.moveToElementText(tempEl);
            tempRange.setEndPoint("EndToEnd", range);
            caretPos = tempRange.text.length;
          }
        }
        return caretPos;
      },
      /*
      @function (private) {Boolean} _isNumeric
      @description Whether the received key event has a numeric value or not
      @param {Object} e
      */
      isNumeric: function (e) {
        return (e.keyCode >= 48 && e.keyCode <= 57) || (e.keyCode >= 96 && e.keyCode <= 105);
      },
      /*
      @function (private) _handleKeyDown
      @description Handles the typing and the date correction, if the sub input reaches its limit it jumps to the next one
      @param {Object} subInput
      @param {Object} e
      */
      handleKeyDown: function (subInput, e) {

        var el = this;
        var selection = window.getSelection();

        if (!el._isNumeric(e)) {

          if (e.keyCode != "9" && e.keyCode != "46" && e.keyCode != "8" && e.keyCode != "37" && e.keyCode != "39") {

            e.preventDefault();
            e.stopPropagation();

          } else {

            if (e.keyCode == "8") {

              var subInputs = el.querySelector(".eon-date-subInputs");
              var previousSubInputOrder = parseInt(subInput.parentNode.dataset.order) - 1;
              var previousSubInput = subInputs.querySelector('[data-order="' + previousSubInputOrder + '"] input');
              var caretPosition = subInput.selectionStart;

              if (!(selection.anchorNode === subInput && selection.extentOffset > 0 && selection.type == "Range")) {
                if (caretPosition == 0 && previousSubInput) {
                  previousSubInput.focus();
                }

              }

            }

          }
        } else {

          var subInputs = el.querySelector(".eon-date-subInputs");

          var nextSubInputOrder = parseInt(subInput.dataset.order) + 1;
          var nextSubInput = subInputs.querySelector('[data-order="' + nextSubInputOrder + '"] input');

          var aux = subInput.value;

          if (!(selection.anchorNode === subInput && selection.extentOffset > 0 && selection.type == "Range")) {

            if (!(aux.length >= el._misc.mask[subInput.parentNode.dataset.field].format.length)) {
              subInput.value = aux + el._getStringFromKeyCode(e.keyCode);
              e.preventDefault();
              e.stopPropagation();
            }


          }

        }

        // Checks if the key press corresponds to ENTER
        if (e.keyCode == 13) {
          eon.triggerCallback("onEnter", el)
        }

      },
      /*
      @function (private) {Number} _getPMHours
      @description Receives a number of hours for AM
      @param {Number} AMHours
      */
      getPMHours: function (AMHours) {
        var PMHours;
        AMHours = parseInt(AMHours);
        if (AMHours <= 12) {
          PMHours = AMHours + 12;
          PMHours = PMHours == 24 ? 0 : PMHours;
        }
        return PMHours;
      },
      /*
      @function (private) {Number} _getAMHours
      @description Receives a number of hours for PM
      @param {Number} PMHours
      */
      getAMHours: function (PMHours) {
        var AMHours;
        PMHours = parseInt(PMHours);
        if (PMHours > 12) {
          AMHours = PMHours - 12;
        } else if (PMHours == 0) {
          AMHours = 12;
        } else {
          AMHours = PMHours;
        }
        return AMHours;
      },
      /*
      @function (private) {String} _getStringFromKeyCode
      @description Receives a keyCode and returns the string value (intended for numeric)
      @param {String} keyCode
      */
      getStringFromKeyCode: function (keyCode) {
        return String.fromCharCode((keyCode >= 96 && keyCode <= 105) ? keyCode - 48 : keyCode)
      },
      /*
      @function (private) _handleKeyUp
      @description Handles the key up event
      @param {Object} subInput 
      @param {Object} e [event]
      */
      handleKeyUp: function (subInput, e) {

        var el = this;

        if (!(document.activeElement.isEqualNode(subInput) && el._getSelectionText().length == subInput.value.length)) {

          if (el._isNumeric(e) || e.keyCode == "8" || e.keyCode == "46") {

            var subInputs = el.querySelector(".eon-date-subInputs");

            var nextSubInputOrder = parseInt(subInput.parentNode.dataset.order) + 1;
            var nextSubInput = subInputs.querySelector('[data-order="' + nextSubInputOrder + '"] input');

            if ((subInput.value.length >= el._misc.mask[subInput.parentNode.dataset.field].format.length)) {

              if (nextSubInput) {
                nextSubInput.focus();
              }

              el._handleCorrection();
            }

          }

        }

        el._validate();

      },
      /*
      @function (private) {String} _getSelectionText
      @description Gets the selected text
      */
      getSelectionText: function () {
        var text = "";
        var activeEl = document.activeElement;
        var activeElTagName = activeEl ? activeEl.tagName.toLowerCase() : null;
        if (
          (activeElTagName == "textarea") || (activeElTagName == "input" &&
            /^(?:text|search|password|tel|url)$/i.test(activeEl.type)) &&
          (typeof activeEl.selectionStart == "number")
        ) {
          text = activeEl.value.slice(activeEl.selectionStart, activeEl.selectionEnd);
        } else if (window.getSelection) {
          text = window.getSelection().toString();
        }
        return text;
      },
      /*
      @function (private) _handleCorrection
      @description Handles the date correction for months and days
      */
      handleCorrection: function () {

        var el = this;

        var subInputs = el.querySelector(".eon-date-subInputs");

        var dayInput = subInputs.querySelector('[data-field="day"] input');
        var monthInput = subInputs.querySelector('[data-field="month"] input');
        var yearInput = subInputs.querySelector('[data-field="year"] input');

        if (el._refs.subInputs.hours.value != "" && parseInt(el._refs.subInputs.hours.value) > 23) {
          el._refs.subInputs.hours.value = "23";
        } else if (el._refs.subInputs.hours.value.length == 2 && parseInt(el._refs.subInputs.hours.value) < 0) {
          el._refs.subInputs.hours.value = "00";
        }

        if (el._refs.subInputs.minutes.value != "" && parseInt(el._refs.subInputs.minutes.value) > 59) {
          el._refs.subInputs.minutes.value = "59";
        } else if (el._refs.subInputs.minutes.value.length == 2 && parseInt(el._refs.subInputs.minutes.value) < 0) {
          el._refs.subInputs.hours.value = "00";
        }

        if (dayInput.value != "" && parseInt(dayInput.value) > 31) {
          dayInput.value = "31";
        } else if (dayInput.value.length == 2 && parseInt(dayInput.value) == 0) {
          dayInput.value = "1";
        }

        if (monthInput.value != "" && parseInt(monthInput.value) > 12) {
          monthInput.value = "12";
        } else if (monthInput.value.length == 2 && parseInt(monthInput.value) == 0) {
          monthInput.value = "1";
        }

        if (yearInput.value != "" && parseInt(yearInput.value) > 9999) {
          yearInput.value = "9999";
        } else if (parseInt(yearInput.value) == 0) {
          yearInput.value = "1";
        }

        if (dayInput.value != "" && monthInput.value != "" && yearInput.value != "" && (yearInput.value.length == el._misc.mask.year.format.length)) {
          if (parseInt(dayInput.value) > eon.time.getDaysInMonth(parseInt(yearInput.value), parseInt(monthInput.value) - 1)) {
            dayInput.value = eon.time.getDaysInMonth(parseInt(yearInput.value), parseInt(monthInput.value) - 1);
          }
        }

        el._handleLimits(dayInput, monthInput, yearInput);
      },
      /*
      @function (private) _handleLimits
      @description Handles the limits such as min/max date
      @param {Object} dayInput
      @param {Object} monthInput
      @param {Object} yearInput
      */
      handleLimits: function (dayInput, monthInput, yearInput) {

        var el = this;

        if (dayInput.value != "" && monthInput.value != "" && yearInput.value != "" && yearInput.value.length == el._misc.mask.year.format.length) {

          var dayInputValue = parseInt(dayInput.value);
          var monthInputValue = parseInt(monthInput.value);
          var yearInputValue = parseInt(yearInput.value);

          if ((dayInputValue < el._misc.min.day && monthInputValue <= el._misc.min.month && yearInputValue == el._misc.min.year) || (monthInputValue < el._misc.min.month && yearInputValue == el._misc.min.year) || yearInputValue < el._misc.min.year) {

            dayInput.value = el._misc.min.day;
            monthInput.value = el._misc.min.month;
            yearInput.value = el._misc.min.year;

          } else if ((dayInputValue > el._misc.max.day && monthInputValue >= el._misc.max.month && yearInputValue == el._misc.max.year) || (monthInputValue > el._misc.max.month && yearInputValue == el._misc.max.year) || yearInputValue > el._misc.max.year) {

            dayInput.value = el._misc.max.day;
            monthInput.value = el._misc.max.month;
            yearInput.value = el._misc.max.year;
          }
        }
      },
      /*
      @function (private) {Boolean} _exceedsMinDate
      @description Returns whether the provided date exceeds the minimal date or not
      @param {Object} dateObj
      */
      exceedsMinDate: function (dateObj) {

        var el = this;

        if (el._misc.min.active) {

          var sameHour = dateObj.hours && dateObj.hours == el._misc.min.hours;
          var sameDay = dateObj.day && dateObj.day == el._misc.min.day;
          var sameMonth = dateObj.month && dateObj.month == el._misc.min.month;
          var sameYear = dateObj.year && dateObj.year == el._misc.min.year;

          var exceedsMinutes = dateObj.minutes && dateObj.minutes < el._misc.min.minutes && sameHour && sameDay && sameMonth && sameYear;
          var exceedsHour = dateObj.hours && dateObj.hours < el._misc.min.hours && sameDay && sameMonth && sameYear;
          var exceedsDay = dateObj.day && dateObj.day < el._misc.min.day && sameMonth && sameYear;
          var exceedsMonth = dateObj.month && dateObj.month < el._misc.min.month && sameYear;
          var exceedsYear = dateObj.year && dateObj.year < el._misc.min.year;
        }

        return exceedsMinutes || exceedsHour || exceedsDay || exceedsMonth || exceedsYear ? true : false;

      },
      /*
      @function (private) {Boolean} _exceedsMaxDate
      @description Returns whether the provided date exceeds the maximum date or not
      @param {Object} dateObj
      */
      exceedsMaxDate: function (dateObj) {

        var el = this;

        if (el._misc.max.active) {

          var sameHour = dateObj.hours && dateObj.hours == el._misc.min.hours;
          var sameDay = dateObj.day && dateObj.day == el._misc.min.day;
          var sameMonth = dateObj.month && dateObj.month == el._misc.min.month;
          var sameYear = dateObj.year && dateObj.year == el._misc.min.year;

          var exceedsMinutes = dateObj.minutes && dateObj.minutes > el._misc.min.minutes && sameHour && sameDay && sameMonth && sameYear;
          var exceedsHour = dateObj.hours && dateObj.hours > el._misc.min.hours && sameDay && sameMonth && sameYear;
          var exceedsDay = dateObj.day && dateObj.day > el._misc.min.day && sameMonth && sameYear;
          var exceedsMonth = dateObj.month && dateObj.month > el._misc.min.month && sameYear;
          var exceedsYear = dateObj.year && dateObj.year > el._misc.min.year;
        }

        return exceedsMinutes || exceedsHour || exceedsDay || exceedsMonth || exceedsYear ? true : false;

      },
      /*
      @function (private) _createWeekDaysHeaders
      @description Creates the weekdays headers for the daysGrid
      */
      createWeekDaysHeaders: function () {

        var el = this;

        var dayHeadersFragment = document.createDocumentFragment();
        var dayHeader;

        for (var i = 0; i < el._misc.weekDays.keys.length; i++) {

          dayHeader = document.createElement("div");
          dayHeader.classList.add("eon-date-dayHeader");
          dayHeader.innerHTML = el._misc.weekDays.display[i];

          dayHeadersFragment.appendChild(dayHeader);
        }

        el._refs.calendar.querySelector(".eon-date-daysGrid .eon-date-weekDays").appendChild(dayHeadersFragment);
      },
      /*
      @function (private) _refresh
      @description Shows the picker and the corresponding grid
      */
      refresh: function () {

        var el = this;

        if (!eon.util.isTrue(el.date) && eon.util.isTrue(el.time)) {

          el._showClockView();

        } else if (eon.util.isTrue(el.date)) {

          if (el._refs.daysGrid) {

            var year = Number(el._misc.current.year) && Number(el._misc.current.year) > 0 ? el._misc.current.year : new Date().toLocaleString([], { year: "numeric" });
            var month = Number(el._misc.current.month) && Number(el._misc.current.month) > 0 ? el._misc.current.month : new Date().toLocaleString([], { month: "numeric" }) - 1;

            el._fillDaysGrid(year, month);
            el._updateHeaderSelectors("days", el._misc.current.year, el._misc.current.month);
            el._showDaysGrid();

          } else if (el._refs.monthsGrid) {

            el._updateHeaderSelectors("months");
            el._showMonthsGrid();

          } else if (el._refs.yearsGrid) {

            el._updateHeaderSelectors("years");
            el._showYearsGrid();
          }

          if (el._refs.yearsGrid) {

            var yearButton = el._refs.yearsGrid.querySelector("[data-year='" + el._misc.current.year + "']");

            if (yearButton && yearButton.dataset.disabled != "true") {
              el._highlight(yearButton, el.querySelector(".eon-date-yearsGrid .eon-date-current"));
            }

          }

          if (el._refs.monthsGrid) {

            var monthButton = el._refs.monthsGrid.querySelector("[data-year='" + el._misc.current.year + "'][data-index='" + el._misc.current.month + "']");

            if (monthButton && monthButton.dataset.disabled != "true") {
              el._highlight(monthButton, el.querySelector(".eon-date-monthsGrid .eon-date-current"));
            }

          }

          if (el._refs.daysGrid) {

            var dayButton = el._refs.daysGrid.querySelector("[year='" + el._misc.current.year + "'][month='" + parseInt(el._misc.current.month) + "'][day='" + parseInt(el._misc.current.day) + "']");

            if (dayButton && dayButton.dataset.disabled != "true") {
              el._highlight(dayButton, el.querySelector(".eon-date-daysGrid .eon-date-grid .eon-date-current"));
            }

          }

        }

      },
      /*
      @function (private) _updateHeaderSelectors
      @description Updates the header depending on the grid passed as parameters
      @param {String} headerType
      @param {Number} year
      @param {Number} month
      */
      updateHeaderSelectors: function (headerType, year, month) {

        var el = this;

        if (headerType == "days") {

          year = (!year) ? el._misc.current.year : year;
          month = (!month) ? el._misc.current.month : month;

          el._refs.selectorsContainer.setAttribute("class", "eon-date-daysGridSelectors");

          el._refs.yearSelector.innerHTML = year;
          el._refs.yearSelector.classList.remove("eon-date-hidden");

          // Depending on the selectable we enabled/disable the hover class
          el._refs.yearSelector.classList[!eon.util.isTrue(el.yearPicking) ? "remove" : "add"]("eon-fg1-hoverable");
          el._refs.monthSelector.classList[!eon.util.isTrue(el.monthPicking) ? "remove" : "add"]("eon-fg1-hoverable");

          el._refs.monthSelector.innerHTML = eon.time.getMonthName(el.locale, month, "long");
          el._refs.monthSelector.classList.remove("eon-date-hidden");

          el._refs.toggle.classList.remove("eon-date-hidden");

          el._refs.previous.dataset.disabled = (el._isMinMonth(year, month)) ? "true" : "false";
          el._refs.previous.classList[el._refs.previous.dataset.disabled == "true" ? "add" : "remove"]("eon-fg2-disabled");
          el._refs.previous.classList[el._refs.previous.dataset.disabled != "true" ? "add" : "remove"]("eon-fg1-hoverable");

          el._refs.next.dataset.disabled = (el._isMaxMonth(year, month)) ? "true" : "false";
          el._refs.next.classList[el._refs.next.dataset.disabled == "true" ? "add" : "remove"]("eon-fg2-disabled");
          el._refs.next.classList[el._refs.next.dataset.disabled != "true" ? "add" : "remove"]("eon-fg1-hoverable");

          el._refs.toggleIcon.classList.remove("vicon-calendar");
          el._refs.toggleIcon.classList.add("vicon-clock");

        } else if (headerType == "months") {

          year = (!year) ? el._misc.current.year : year;

          el._refs.selectorsContainer.setAttribute("class", "eon-date-monthsGridSelectors");

          el._refs.yearSelector.innerHTML = year;
          el._refs.monthSelector.classList.add("eon-date-hidden");

          // Depending on the selectable we enabled/disable the hover class
          el._refs.yearSelector.classList[!eon.util.isTrue(el.yearPicking) ? "remove" : "add"]("eon-fg1-hoverable");
          el._refs.monthSelector.classList[!eon.util.isTrue(el.monthPicking) ? "remove" : "add"]("eon-fg1-hoverable");

          el._refs.toggle.classList.add("eon-date-hidden");

          el._refs.previous.dataset.disabled = (year <= el._misc.min.year) ? "true" : "false";
          el._refs.previous.classList[el._refs.previous.dataset.disabled == "true" ? "add" : "remove"]("eon-fg2-disabled");

          el._refs.next.dataset.disabled = (year >= el._misc.max.year) ? "true" : "false";
          el._refs.next.classList[el._refs.next.dataset.disabled == "true" ? "add" : "remove"]("eon-fg2-disabled");

        } else if (headerType == "years") {

          year = (!year) ? el._misc.selector.range.start + "-" + el._misc.selector.range.end : year;

          el._refs.selectorsContainer.setAttribute("class", "eon-date-yearsGridSelectors");

          el._refs.yearSelector.innerHTML = year;
          el._refs.yearSelector.classList.remove("eon-fg1-hoverable");

          el._refs.monthSelector.classList.add("eon-date-hidden");

          el._refs.toggle.classList.add("eon-date-hidden");

          el._refs.previous.dataset.disabled = (el._misc.selector.range.start <= el._misc.min.year) ? "true" : "false";
          el._refs.previous.classList[el._refs.previous.dataset.disabled == "true" ? "add" : "remove"]("eon-fg2-disabled");

          el._refs.next.dataset.disabled = (el._misc.selector.range.end >= el._misc.max.year) ? "true" : "false";
          el._refs.next.classList[el._refs.next.dataset.disabled == "true" ? "add" : "remove"]("eon-fg2-disabled");

        }

        else if (headerType == "time") {

          if (!eon.util.isTrue(el.date)) {

            el._refs.calendar.querySelector(".eon-date-header").style.display = "none";

          } else {

            el._refs.monthSelector.classList.add("eon-date-hidden");
            el._refs.yearSelector.classList.add("eon-date-hidden");
            el._refs.toggle.classList.add("eon-date-hidden");

            el._refs.previous.classList.add("eon-date-hidden");
            el._refs.next.classList.add("eon-date-hidden");

            el._refs.toggle.classList.remove("eon-date-hidden");
            el._refs.toggleIcon.classList.remove("vicon-clock");

            el._refs.toggleIcon.classList.add("vicon-calendar");

          }


        }

      },
      /*
      @function (private) _highlight
      @description Highlights the button and removes highlight in the previous one
      @param {Object} selected
      @param {Object} previous
      */
      highlight: function (selected, previous) {

        var el = this;

        if (previous) {
          previous.classList.remove("eon-date-current", "eon-bg2-active");
          previous.classList.add("eon-bg2-hoverable", "eon-fg1-hoverable");
        }

        selected.classList.add("eon-date-current", "eon-bg2-active");
        selected.classList.remove("eon-bg2-hoverable", "eon-fg1-hoverable");
      },
      /*
      @function (private) {Object} _formatObj
      @description Receives an object with a day/year/month and returns an object with the same values with the provided format
      @param {Object} obj
      */
      formatObj: function (obj) {

        var el = this;

        var format = el.valueFormat;

        var dayFormat = (format.match(/[d|D]{1,2}/)) ? format.match(/[d|D]{1,2}/)[0] : null;
        var monthFormat = (format.match(/[M]{1,4}/)) ? format.match(/[M]{1,4}/)[0] : null;
        var yearFormat = (format.match(/[y|Y]{2,4}/)) ? format.match(/[y|Y]{2,4}/)[0] : null;

        var finalObj = {};

        finalObj.minutes = obj.minutes != null ? ("0" + obj.minutes).slice(-2) : null;
        finalObj.hours = obj.hours != null ? ("0" + obj.hours).slice(-2) : null;
        finalObj.day = obj.day != null ? el._format(obj.day, dayFormat) : null;
        finalObj.month = obj.month != null ? el._format(obj.month, monthFormat) : null;
        finalObj.year = obj.year != null ? el._format(obj.year, yearFormat) : null;

        return finalObj;

      },
      /*
      @function (private) _handleAutoHeight
      @description Maintains an aspect ratio for the picker relative to its width
      */
      handleAutoHeight: function () {

        var el = this;
        var calendar = el._refs.calendar;

        if (calendar.offsetWidth != 0) {
          el._refs.body.style.height = (parseFloat(calendar.offsetWidth) * el._misc.heightRatio) + "px";
        }

      },
      /*
      @function (private) _handleFonts
      @description It handles the fontSizes for different picker widths
      */
      handleFonts: function () {

        var el = this;
        var calendar = el._refs.calendar;

        var baseFontSize, weekDaysConstant, headerConstant;
        var daysFontSize, weekDaysFontSize, headerFontSize, navigation, otherGridsFontSize;

        weekDaysConstant = 1.0667;

        if (parseInt(calendar.offsetWidth) >= 240) {

          baseFontSize = el.fontSize;
          navigation = 24;
          headerConstant = 1.1111111111;
          otherGridsConstant = 1.1111111111;

        } else {

          baseFontSize = el.fontSize * 0.75;
          navigation = 18;
          headerConstant = 1.197916667;
          otherGridsConstant = 1.296296296;
        }

        daysFontSize = baseFontSize;
        weekDaysFontSize = baseFontSize / weekDaysConstant;
        headerFontSize = baseFontSize * headerConstant;
        otherGridsFontSize = baseFontSize * otherGridsConstant

        if (calendar.querySelector(".eon-date-daysGrid")) {
          calendar.querySelector(".eon-date-daysGrid .eon-date-grid").style.fontSize = baseFontSize + "px";
          calendar.querySelector(".eon-date-daysGrid .eon-date-weekDays").style.fontSize = weekDaysFontSize + "px";
        }

        if (calendar.querySelector(".eon-date-monthsGrid")) {
          calendar.querySelector(".eon-date-monthsGrid").style.fontSize = otherGridsFontSize + "px"
        }

        if (calendar.querySelector(".eon-date-yearsGrid")) {
          calendar.querySelector(".eon-date-yearsGrid").style.fontSize = otherGridsFontSize + "px"
        }

        calendar.querySelector(".eon-date-header").style.fontSize = headerFontSize + "px";

        calendar.querySelector(".eon-date-toggle i").style.fontSize = navigation + "px";
        calendar.querySelector(".eon-date-previous i").style.fontSize = navigation + "px";
        calendar.querySelector(".eon-date-next i").style.fontSize = navigation + "px";
      },
      /*
      @function (private) _goToPrevious
      @description Handles the redirection to whether the month/year/day previous callback
      @param {Object} button
      */
      goToPrevious: function (button) {

        var el = this;

        if (el._misc.selector.type == "month") {
          el._goToPreviousMonth(button);
        } else if (el._misc.selector.type == "year") {
          el._goToPreviousYear(button);
        } else if (el._misc.selector.type == "yearsRange") {
          el._goToPreviousYearsRange(button);
        }
      },
      /*
      @function (private) _goToPreviousMonth
      @description Fills the daysGrid with the previous Month
      @param {Object} button
      */
      goToPreviousMonth: function (button) {

        var el = this;

        if (button.dataset.disabled != "true") {

          var previous = el._getPreviousByMonth(el._misc.current.year, el._misc.current.month);


          el._fillDaysGrid(previous.year, previous.month);
          el._updateHeaderSelectors("days", previous.year, previous.month);
        }
      },
      /*
      @function (private) _goToNext
      @description Handles the redirection to whether the month/year/day next callback
      @param {Object} button
      */
      goToNext: function (button) {

        var el = this;

        if (el._misc.selector.type == "month") {
          el._goToNextMonth(button);
        } else if (el._misc.selector.type == "year") {
          el._goToNextYear(button);
        } else if (el._misc.selector.type == "yearsRange") {
          el._goToNextYearsRange(button);
        }
      },
      /*
      @function (private) _goToNextMonth
      @description Fills the daysGrid with the next Month
      @param {Object} button
      */
      goToNextMonth: function (button) {

        var el = this;

        if (button.dataset.disabled != "true") {
          var next = el._getNextByMonth(el._misc.current.year, el._misc.current.month);

          el._fillDaysGrid(next.year, next.month);
          el._updateHeaderSelectors("days", next.year, next.month);
        }
      },
      /*
      @function (private) _goToPreviousYear
      @description Changes the actual year, for the previous one
      @param {Object} button
      */
      goToPreviousYear: function (button) {

        var el = this;

        if (button.dataset.disabled != "true") {

          el._misc.current.year = el._misc.current.year - 1;

          el._updateHeaderSelectors("months");
          el._fillMonthsGrid();
        }
      },
      /*
      @function (private) _goToNextYear
      @description Changes the actual year, for the next one
      @param {Object} button
      */
      goToNextYear: function (button) {

        var el = this;

        if (button.dataset.disabled != "true") {

          el._misc.current.year = parseInt(el._misc.current.year) + 1;

          el._updateHeaderSelectors("months");
          el._fillMonthsGrid();
        }
      },
      /*
      @function (private) _goToPreviousYearsRange
      @description Changes the actual years range, for the previous one
      @param {Object} button
      */
      goToPreviousYearsRange: function (button) {

        var el = this;

        if (button.dataset.disabled != "true") {
          el._misc.selector.range.start = el._misc.selector.range.start - 12;
          el._misc.selector.range.end = el._misc.selector.range.start + 11;

          el._fillYearsGrid();
          el._updateHeaderSelectors("years");
        }
      },
      /*
      @function (private) _goToNextYearsRange
      @description Changes the actual years range, for the next one
      @param {Object} button
      */
      goToNextYearsRange: function (button) {

        var el = this;

        if (button.dataset.disabled != "true") {
          el._misc.selector.range.end = el._misc.selector.range.end + 12;
          el._misc.selector.range.start = el._misc.selector.range.end - 11;

          el._fillYearsGrid();
          el._updateHeaderSelectors("years");
        }
      },
      /*
      @function (private) _fillDaysGrid
      @description Fills the grid with the corresponding days for the provided year/month
      @param {Number} year
      @param {Number} month
      */
      fillDaysGrid: function (year, month) {

        var el = this;

        var gridWeeks = el._refs.calendar.querySelector(".eon-date-grid").children;

        var monthDays = eon.time.getDaysInMonth(year, month);
        var monthFirstWeekDay = eon.time.getFirstWeekDay("en", year, month, "long");

        var previous = el._getPreviousByMonth(year, month);
        var next = el._getNextByMonth(year, month);

        var previousMonthDaysToDisplay = el._getPreviousMonthDaysToDisplay(year, month);
        var nextMonthDaysToDisplay = el._getNextMonthDaysToDisplay(year, month, monthDays, previousMonthDaysToDisplay);

        var week = gridWeeks[0];

        var currentWeek = 0;
        var weekDaysCount = 0;
        var dummyDay, day;

        var areLimits = (el._misc.min.active == true || el._misc.max.active == true);

        if (areLimits) {
          var isPreviousMonthMin = el._isMinMonth(previous.year, previous.month);
          var isMinMonth = el._isMinMonth(year, month);
          var isNextMonthMin = el._isMinMonth(next.year, next.month);

          var isPreviousMonthMax = el._isMaxMonth(previous.year, previous.month);
          var isMaxMonth = el._isMaxMonth(year, month);
          var isNextMonthMax = el._isMaxMonth(next.year, next.month);

          var disableDayAsMin, disableDayAsMax;
        }

        el._misc.current.year = year;
        el._misc.current.month = month;

        //Create previous Month Days
        for (var i = 0; i < previousMonthDaysToDisplay.length; i++) {
          if (el._misc.weekDays.keys[i] == monthFirstWeekDay) {
            break;
          } else {

            day = week.children[weekDaysCount];

            if (day) {

              day.innerHTML = previousMonthDaysToDisplay[i];
              day.classList.add("eon-date-previousMonth", "eon-fg2-disabled");
              day.classList.remove("eon-date-current", "eon-bg2-active");

              day.setAttribute("year", previous.year);
              day.setAttribute("month", previous.month);
              day.setAttribute("day", previousMonthDaysToDisplay[i]);

              if (areLimits) {

                disableDayAsMin = (isPreviousMonthMin && previousMonthDaysToDisplay[i] < el._misc.min.day || isMinMonth || isNextMonthMin) ? true : false;
                disableDayAsMax = (isPreviousMonthMax && previousMonthDaysToDisplay[i] > el._misc.max.day) ? true : false;

                day.dataset.disabled = ((disableDayAsMin && disableDayAsMax) || (disableDayAsMin || disableDayAsMax)) ? "true" : "false";
              }

            }

            weekDaysCount++;
          }
        }

        //Create actual month days
        for (var i = 1; i <= monthDays; i++) {

          day = week.children[weekDaysCount];

          if (day) {
            day.classList.remove("eon-date-previousMonth", "eon-fg2-disabled", "eon-date-nextMonth", "eon-fg2-disabled", "eon-date-current", "eon-bg2-active");
            day.innerHTML = i;

            day.setAttribute("year", year);
            day.setAttribute("month", parseInt(month));
            day.setAttribute("day", i);

            weekDaysCount++;

            if (weekDaysCount == 7) {

              week = gridWeeks[currentWeek + 1];
              weekDaysCount = 0;

              currentWeek++;
            }

            if (areLimits) {

              disableDayAsMin = (isMinMonth && i < el._misc.min.day || isNextMonthMin) ? true : false;
              disableDayAsMax = (isPreviousMonthMax || isMaxMonth && i > el._misc.max.day) ? true : false;

              day.dataset.disabled = ((disableDayAsMin && disableDayAsMax) || (disableDayAsMin || disableDayAsMax)) ? "true" : "false";
              day.classList[day.dataset.disabled == "true" ? "add" : "remove"]("eon-fg2-disabled");
            }

          }
        }

        //Create next month days
        for (var i = 0; i < nextMonthDaysToDisplay.length; i++) {

          day = week.children[weekDaysCount];

          if (day) {

            day.innerHTML = nextMonthDaysToDisplay[i];
            day.classList.add("eon-date-nextMonth", "eon-fg2-disabled");
            day.classList.remove("eon-date-current", "eon-bg2-active");

            day.setAttribute("year", next.year);
            day.setAttribute("month", parseInt(next.month));
            day.setAttribute("day", nextMonthDaysToDisplay[i]);

            weekDaysCount++;

            if (weekDaysCount == 7) {

              week = gridWeeks[currentWeek + 1];
              weekDaysCount = 0;

              currentWeek++;
            }

            if (areLimits) {

              disableDayAsMin = (isNextMonthMin && nextMonthDaysToDisplay[i] < el._misc.min.day) ? true : false;
              disableDayAsMax = (isNextMonthMax && nextMonthDaysToDisplay[i] > el._misc.max.day || isMaxMonth || isPreviousMonthMax) ? true : false;

              day.dataset.disabled = ((disableDayAsMin && disableDayAsMax) || (disableDayAsMin || disableDayAsMax)) ? "true" : "false";
            }

          }
        }

        // var currentDay = el._refs.daysGrid.querySelector('[day="' + parseInt(el._misc.selected.day) + '"][month="' + parseInt(el._misc.selected.month) + '"][year="' + parseInt(el._misc.selected.year) + '"]');
        var currentDay = el._refs.daysGrid.querySelector('[day="' + parseInt(el._misc.current.day) + '"][month="' + parseInt(el._misc.current.month) + '"][year="' + parseInt(el._misc.current.year) + '"]');

        if (currentDay) {
          el._highlight(currentDay);
        }
      },
      /*
      @function (private) _fillMonthsGrid
      @description When the monthsGrid is about the be showed, we handle the ones that the user can click on, and also point out the current month if needed
      */
      fillMonthsGrid: function () {

        var el = this;
        var monthsGrid = el._refs.calendar.querySelector(".eon-date-monthsGrid");
        var months = monthsGrid.querySelectorAll('[data-index]');
        var month, disableMonthAsMin, disableMonthAsMax;

        for (var i = 0; i < 12; i++) {

          year = el._misc.current.year;
          month = months[i].dataset.index;

          months[i].dataset.year = year;
          months[i].classList.remove("eon-date-current");
          months[i].classList.remove("eon-bg2-active");

          if (el._misc.current.year == el._misc.min.year || el._misc.current.year == el._misc.max.year) {

            disableMonthAsMin = (year == el._misc.min.year && month < el._misc.min.month || year < el._misc.min.year) ? true : false;
            disableMonthAsMax = (year == el._misc.max.year && month > el._misc.max.month || year > el._misc.max.year) ? true : false;

            months[i].dataset.disabled = ((disableMonthAsMin || disableMonthAsMax) || (disableMonthAsMin && disableMonthAsMax)) ? "true" : "false";

          } else {
            months[i].dataset.disabled = "false";
          }

          months[i].classList[months[i].dataset.disabled == "true" ? "add" : "remove"]("eon-fg2-disabled");
        }

        // var currentMonthCell = monthsGrid.querySelector('[data-index ="' + parseInt(el._misc.selected.month) + '"][data-year ="' + parseInt(el._misc.selected.year) + '"]');
        var currentMonthCell = monthsGrid.querySelector('[data-index ="' + parseInt(el._misc.current.month) + '"][data-year ="' + parseInt(el._misc.current.year) + '"]');

        if (currentMonthCell) {
          el._highlight(currentMonthCell, el.querySelector(".eon-date-monthsGrid .eon-date-current"));
        }
      },
      /*
      @function (private) _fillYearsGrid
      @description Fills the grid with the year corresponding to the years range
      */
      fillYearsGrid: function () {

        var el = this;
        var yearsGrid = el._refs.calendar.querySelector(".eon-date-yearsGrid");
        var yearsGridRow = yearsGrid.children;
        var year = el._misc.selector.range.start;
        var row;
        var selectedYearCell;

        for (var i = 0; i < yearsGridRow.length; i++) {

          row = yearsGridRow[i];

          for (var j = 0; j < 4; j++) {
            row.children[j].innerHTML = year;
            row.children[j].dataset.year = year;
            row.children[j].classList.remove("eon-date-current");
            row.children[j].classList.remove("eon-bg2-active");
            row.children[j].classList.add("eon-bg2-hoverable");

            disableYearAsMin = (parseInt(year) < el._misc.min.year) ? true : false;
            disableYearAsMax = (parseInt(year) > el._misc.max.year) ? true : false;
            row.children[j].dataset.disabled = ((disableYearAsMin || disableYearAsMax) || (disableYearAsMin && disableYearAsMax)) ? "true" : "false";
            row.children[j].classList[row.children[j].dataset.disabled == "true" ? "add" : "remove"]("eon-fg2-disabled");

            year++;
          }
        }

        // selectedYearCell = yearsGrid.querySelector('[data-year ="' + el._misc.selected.year + '"]');
        selectedYearCell = yearsGrid.querySelector('[data-year ="' + el._misc.current.year + '"]');

        if (selectedYearCell) {
          el._highlight(selectedYearCell, el.querySelector(".eon-date-yearsGrid .eon-date-current"));
        }
      },
      /*
      @function (private) _selectDay
      @description Selects the day clicked and runs its default behavior if the user didn't specify a custom callback
      @param {Object} dayButton
      */
      selectDay: function (dayButton) {

        if (dayButton.dataset.disabled != "true") {

          var el = this;

          el._misc.current.day = parseInt(dayButton.getAttribute("day"));
          el._misc.current.month = parseInt(dayButton.getAttribute("month"));
          el._misc.current.year = parseInt(dayButton.getAttribute("year"));

          el._highlight(dayButton, el._refs.calendar.querySelector(".eon-date-daysGrid .eon-date-grid .eon-date-current"));

          if (el.type == "calendar") {
            el._updateWithCurrentValues();
          }

          eon.triggerCallback("onDaySelected", el, el, []);

        }
      },
      /*
      @function (private) _selectMonth
      @description Selects the month clicked and runs its default behavior if the user didn't specify a specific function
      @param {Object} monthButton
      */
      selectMonth: function (monthButton) {

        var el = this;

        if (monthButton.dataset.disabled != "true") {

          el._misc.current.month = parseInt(monthButton.dataset.index);

          if (eon.util.isTrue(el.dayPicking)) {
            el._fillDaysGrid(el._misc.current.year, el._misc.current.month);
            el._showDaysGrid();
          }

          el._highlight(monthButton, el.querySelector(".eon-date-monthsGrid .eon-date-current"));

          if (el.type == "calendar") {
            el._updateWithCurrentValues();
          }

          eon.triggerCallback("onMonthSelected", el, el, []);

        }
      },
      /*
      @function (private) _selectYear
      @description Selects the year clicked and runs its default behavior if the user didn't specify a specific function
      @param {Object} yearButton
      */
      selectYear: function (yearButton) {

        var el = this;

        if (yearButton.dataset.disabled != "true") {

          el._misc.current.year = parseInt(yearButton.dataset.year);

          if (el._isMinMonth(el._misc.current.year, el._misc.current.month)) {
            el._misc.current.month = el._misc.min.month;
          }

          if (eon.util.isTrue(el.dayPicking)) {
            el._fillDaysGrid(el._misc.current.year, el._misc.current.month);
            el._showDaysGrid();
          } else if (eon.util.isTrue(el.monthPicking)) {
            el._fillMonthsGrid();
            el._showMonthsGrid();
          }

          el._highlight(yearButton, el.querySelector(".eon-date-yearsGrid .eon-date-current"));

          if (el.type == "calendar") {
            el._updateWithCurrentValues();
          }

          eon.triggerCallback("onYearSelected", el, el, []);

        }

      },
      /*
      @function (private) _showDaysGrid
      @description Shows the daysGrid and hides the other ones, it also updates the headerSelectors
      */
      accept: function () {
        this._updateWithCurrentValues();
        this._shrink();
      },
      updateWithCurrentValues: function () {
        var el = this;
        // We have to add 1 to the month because the indexes are set starting from 0 to match it with the way js Date works
        var dateObj = el._formatObj({
          day: el._misc.current.day,
          month: el._misc.current.month + 1,
          year: el._misc.current.year,
          hours: el._misc.clock.currentPMHours,
          minutes: el._misc.clock.currentMinutes
        });
        
        el.value = eon.time.generateOutput(dateObj, el.valueFormat);
      },
      /*
      @function (private) _showDaysGrid
      @description Shows the daysGrid and hides the other ones, it also updates the headerSelectors
      */
      showDaysGrid: function () {

        var el = this;

        el._hideCurrentView();

        el._refs.daysGrid.style.zIndex = 0;
        el._refs.daysGrid.style.opacity = 1;

        el._updateHeaderSelectors("days");

        el._misc.selector.type = "month";

        el._misc.previousView = el._misc.currentView;
        el._misc.currentView = el._refs.daysGrid;
      },
      /*
      @function (private) _showMonthsGrid
      @description Shows the months grid and hides the other ones, it also updates the headerSelectors
      */
      showMonthsGrid: function () {

        var el = this;

        el._hideCurrentView();

        el._refs.monthsGrid.style.zIndex = 0;
        el._refs.monthsGrid.style.opacity = 1;

        el._updateHeaderSelectors("months");
        el._fillMonthsGrid();

        el._misc.selector.type = "year";

        el._misc.previousView = el._misc.currentView;
        el._misc.currentView = el._refs.monthsGrid;

      },
      /*
      @function (private) _showYearsGrid
      @description Shows the yearsGrid and hides the other ones, it also updates the headerSelectors
      */
      showYearsGrid: function () {

        var el = this;

        el._hideCurrentView();

        el._refs.yearsGrid.style.zIndex = 1;
        el._refs.yearsGrid.style.opacity = 1;

        el._misc.selector.range.start = parseInt(el._misc.current.year) - 6;
        el._misc.selector.range.end = parseInt(el._misc.current.year) + 5;

        el._fillYearsGrid();
        el._updateHeaderSelectors("years");

        el._misc.selector.type = "yearsRange";

        el._misc.previousView = el._misc.currentView;
        el._misc.currentView = el._refs.yearsGrid;

      },
      /*
      @function (private) showClockView
      @description Shows the clock view
      */
      showClockView: function () {

        var el = this;

        el._hideCurrentView();
        // el._setCurrentTime();

        el._refs.clockView.style.zIndex = 1;
        el._refs.clockView.style.opacity = 1;

        el._updateHeaderSelectors("time");

        el._misc.selector.type = "time";

        el._misc.previousView = el._misc.currentView;
        el._misc.currentView = el._refs.clockView;

      },
      /*
      @function (private) _hideCurrentView
      @description Hides the currentView
      */
      hideCurrentView: function () {

        var el = this;

        if (el._misc.currentView) {
          el._misc.currentView.style.zIndex = -1;
          el._misc.currentView.style.opacity = 0;
        }

      },
      /*
      @function (private) {Object} _getPreviousByMonth
      @description Gets the previous month, the year is returned as well in case the current month is January
      @param {Number} year
      @param {Number} month
      */
      getPreviousByMonth: function (year, month) {

        if (parseInt(month) - 1 < 0) {
          month = 11
          year = parseInt(year) - 1;
        } else {
          month = parseInt(month) - 1;
        }

        return {
          "month": month,
          "year": year
        };
      },
      /*
      @function (private) {Object} _getNextByMonth
      @description Gets the next month, the year is returned as well in case the current month is December
      @param {Number} year
      @param {Number} month
      */
      getNextByMonth: function (year, month) {

        if (parseInt(month) + 1 > 11) {
          month = 0
          year = parseInt(year) + 1;
        } else {
          month = parseInt(month) + 1;
        }

        return {
          "month": month,
          "year": year
        };
      },
      /*
      @function (private) {Array} _getPreviousMonthDaysToDisplay
      @description Gets the previous month days to show along the current month
      @param {Number} year
      @param {Number} month
      */
      getPreviousMonthDaysToDisplay: function (year, month) {

        var el = this;

        var monthFirstWeekDay = eon.time.getFirstWeekDay("en", year, month, "long");

        var previous = el._getPreviousByMonth(year, month);
        var previousMonthDaysToDisplay = [];
        var previousMonthDays;

        var daysUntilMonthStart = 0;

        previousMonthDays = eon.time.getDaysInMonth(previous.year, previous.month)

        for (var i = 0; i < el._misc.weekDays.keys.length; i++) {
          if (monthFirstWeekDay != el._misc.weekDays.keys[i]) {
            previousMonthDaysToDisplay.push(previousMonthDays - i)
          } else {
            break;
          }
        }

        return previousMonthDaysToDisplay.reverse();
      },
      /*
      @function (private) {Array} _getNextMonthDaysToDisplay
      @description Gets the next month days to show along the current month
      @param {Number} year
      @param {Number} month
      @param {Number} monthDays
      @param {Array} previousMonthDaysToDisplay
      */
      getNextMonthDaysToDisplay: function (year, month, monthDays, previousMonthDaysToDisplay) {

        var el = this;

        var nextMonthDaysToDisplay = [];
        var remainingDaysToFill = 42 - monthDays - previousMonthDaysToDisplay.length;

        //Theres no need to know which is the current month as they all start the same
        for (var i = 1; i <= remainingDaysToFill; i++) {
          nextMonthDaysToDisplay.push(i);
        }

        return nextMonthDaysToDisplay;
      },
      /*
      @function (private) _updateLabel
      @description Updates the label node with the new label
      */
      updateLabel: function () {

        var el = this;

        if (el.label != "") {
          el.querySelector(".eon-date-label").innerHTML = el.label;
        }

      },
      /*
      @function (private) _updateDisabled
      @description Updates disabled status
      */
      updateDisabled: function () {

        var el = this;

        if (el.type == "calendar") {

          var selectedCell = el.querySelector(".eon-bg2-active");

          if (eon.util.isTrue(el.disabled)) {

            if (selectedCell) {
              selectedCell.classList.remove("eon-bg2-active");
              selectedCell.classList.add("eon-bg2-disabled");
            }

            el._refs.data.classList.add("eon-fg2-disabled");
            el._refs.header.classList.add("eon-fg2-disabled");
            el._refs.body.classList.add("eon-fg2-disabled");

          } else {

            if (selectedCell) {
              selectedCell.classList.add("eon-bg2-active");
              selectedCell.classList.remove("eon-bg2-disabled");
            }

            el._refs.data.classList.remove("eon-fg2-disabled");
            el._refs.header.classList.remove("eon-fg2-disabled");
            el._refs.body.classList.remove("eon-fg2-disabled");

          }

        } else {

          if (eon.util.isTrue(el.disabled)) {

            el._refs.subInputsWrapper.classList.add("eon-fg2-disabled");

            el._refs.calendarButton.classList.remove("eon-fg2");
            el._refs.calendarButton.classList.add("eon-fg2-disabled");

            el._refs.data.classList.add("eon-fg2-disabled");
            el._refs.main.classList.add("eon-fg2-disabled");

            el._shrink();

          } else {

            el._refs.subInputsWrapper.classList.remove("eon-fg2-disabled");

            el._refs.calendarButton.classList.add("eon-fg2");
            el._refs.calendarButton.classList.remove("eon-fg2-disabled");

            el._refs.data.classList.remove("eon-fg2-disabled");
            el._refs.main.classList.remove("eon-fg2-disabled");

          }

        }

      },
      /*
      @function (private) _updateReadOnly
      @description Updates readonly status
      */
      updateReadOnly: function () {

        var el = this;

        if (eon.util.isTrue(el.readonly)) {

          el._refs.fields.first.setAttribute("readonly", "true");
          el._refs.fields.second.setAttribute("readonly", "true");
          el._refs.fields.third.setAttribute("readonly", "true");

          el._refs.calendarButton.classList.remove("eon-fg2-hoverable");

        } else {

          el._refs.fields.first.removeAttribute("readonly");
          el._refs.fields.second.removeAttribute("readonly");
          el._refs.fields.third.removeAttribute("readonly");

          el._refs.calendarButton.classList.add("eon-fg2-hoverable");

          if (el.type != "calendar") {
            el._shrink();
          }

        }

      },
      /*
      @function (private) _updateValue
      @description Allows the user tu set a new value to the element
      @param {Object} value
      */
      updateValue: function () {

        var el = this;

        if (!el._misc.preventUpdate) {

          var format = el.valueFormat;

          var subInputsWrapper = el._refs.subInputsWrapper;
          var dayInput = subInputsWrapper.querySelector('[data-field="day"] input');
          var monthInput = subInputsWrapper.querySelector('[data-field="month"] input');
          var yearInput = subInputsWrapper.querySelector('[data-field="year"] input');

          var valueObj = el.value.constructor == Date ? eon.time.getDateValueObjectFromDate(el.value, el.time) : eon.time.getDateValueObjectFromString(el.value, el.valueFormat, el.time);

          el._misc.current.day = valueObj.day;
          el._misc.current.month = valueObj.month - 1;
          el._misc.current.year = valueObj.year;

          dayInput.value = el._format(valueObj.day, el._misc.mask.day.format);
          monthInput.value = el._format(valueObj.month, el._misc.mask.month.format);
          yearInput.value = el._format(valueObj.year, el._misc.mask.year.format);

          if (eon.util.isTrue(el.time)) {

            el._misc.clock.currentPMHours = valueObj.hours;
            el._misc.clock.currentAMHours = el._getAMHours(el._misc.clock.currentPMHours);
            el._misc.clock.currentMinutes = valueObj.minutes;

            el._refs.subInputs.hours.value = ("0" + el._misc.clock.currentPMHours).slice(-2);
            el._refs.subInputs.minutes.value = ("0" + el._misc.clock.currentMinutes).slice(-2);

            // Picker Clock
            el._refs.currentMinutes.innerHTML = ("0" + el._misc.clock.currentMinutes).slice(-2);
            el._refs.currentHours.innerHTML = ("0" + el._misc.clock.currentAMHours).slice(-2);

          }

        }

        el._misc.preventUpdate = false;

      },

      /*
      @function (private) _updateInvalid
      @description Updates the invalid status
      */
      updateInvalid: function () {

        var el = this;
        var classListFn = eon.util.isTrue(el.invalid) ? "add" : "remove";

        el.classList[classListFn]("eon-date-error");

      }

    },
    functions: {
      /*
      @function clear
      @description Empties the value
      */
      clear: function () {
        this.value = "";
      },
      /*
      @function reset
      @description Resets the value of the element to the default one, if no default is provided then empties the value
      */
      reset: function () {

        var el = this;

        if (el.default != "") {
          el.value = el.default;
          el._refresh();
        } else {
          el.clear();
        }

      },

      /*
      @function updateDescription
      @description Updates the description value for the element
      */
      updateDescription: function (text) {
        this._misc.descriptionText = text;
        this._refs.description.innerHTML = this._misc.descriptionText;
      },
      /*
      @function resetDescription
      @description Updates the description value for the element
      */
      resetDescription: function () {

        var el = this;
        var description = el.tooltip != "" ? el.tooltip : "";

        el._misc.descriptionText = description;
        el._refs.description.innerHTML = description;

      }
    },
    onCreated: function () {

      var el = this;

      eon.createCallback("onEnter", this);
      eon.createCallback("onDaySelected", this);
      eon.createCallback("onMonthSelected", this);
      eon.createCallback("onYearSelected", this);

      if (eon.util.isTouchScreen()) {
        el.dataset.touch = "true";
      }

      eon.registerPathListener(el, "date");

    },
    onInit: function () {

      var el = this;

      el._setupMisc();
      el._setupRefs();
      el._setupOverlay();
      el._setupType();
      el._setupDescription();
      el._setupClock();

      el._refs.okButton.addEventListener("click", function () {
        el._accept();
      });

      if (el.time == "true") {
        el._setCurrentTime();
      }

      el._setupLabelAnimation();

    },
    onRender: function () {
      this._setup();
    },
    onPropertyChanged: function (key, oldVal, newVal) {

      switch (key) {
        case "label":
          this._updateLabel();
          break;
        case "disabled":
          this._updateDisabled();
          break;
        case "readonly":
          this._updateReadOnly();
          break;
        case "value":
          this._updateValue();
          break;
        case "invalid":
          this._updateInvalid();
          break;
      }

    },
    onWindowResize: function () {

      var el = this;

      if (el._misc.modal.active) {
        el._shrink();
      }

    }
  });

</script>